generator client {
  provider = "prisma-client-js"
  output   = "../generated/client"
}

datasource db {
  provider = "postgresql"
}

enum DeliveryStatus {
  Initialized
  Intransit
  OutForDelivery
  Delivered
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  name         String?
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  keys    UserKeys?
  profile UserProfile?
}

model Farmer {
  id           String         @id @default(uuid())
  name         String
  email        String         @unique
  passwordHash String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  keys         FarmerKeys?
  profile      FarmerProfile?
  products     Products[]
}

model UserProfile {
  id            String   @id @default(uuid())
  userId        String   @unique
  bio           String?
  addressLine01 String
  addressLine02 String
  phoneNumber   String
  postalCode    String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model FarmerProfile {
  id         String   @id @default(uuid())
  farmerId   String   @unique
  bio        String?
  location   String
  trustScore Float    @default(0)
  rating     Float    @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  farmer     Farmer   @relation(fields: [farmerId], references: [id])
}

model DeliveryAgent {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  name         String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  profile DeliveryAgentProfile?
}

model DeliveryAgentProfile {
  id          String        @id @default(uuid())
  phoneNumber String
  orderCount  Int           @default(0)
  rating      Float         @default(0)
  agentId     String        @unique
  agent       DeliveryAgent @relation(fields: [agentId], references: [id])
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Admin {
  id String @id @default(uuid())
}

model Products {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  farnerId  String
  farner    Farmer   @relation(fields: [farnerId], references: [id])
}

model Order {
  id        String    @id @default(uuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  delivery  Delivery?
  nfc       OrderNFC?
  nft       OrderNFT?
}

model OrderNFC {
  id        String   @id @default(uuid())
  nfcId     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Order     Order    @relation(fields: [id], references: [id])
}

model OrderNFT {
  id        String   @id @default(uuid())
  tokenId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Order     Order    @relation(fields: [id], references: [id])

  @@index([id])
}

model Delivery {
  id      String @id @default(uuid())
  orderId String @unique
  order   Order  @relation(fields: [orderId], references: [id])
  agentId String @unique

  @@index([id])
}

model UserKeys {
  id                  String   @id @default(uuid()) @map("key_id")
  publicKey           String   @unique @map("public_key")
  encryptedPrivateKey String   @map("encrypted_private_key")
  meta                Json // { iv, salt, scheme }
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  userId              String   @unique @map("user_id")
  user                User     @relation(fields: [userId], references: [id])

  @@map("keys")
}

model FarmerKeys {
  id                  String   @id @default(uuid()) @map("key_id")
  publicKey           String   @unique @map("public_key")
  encryptedPrivateKey String   @map("encrypted_private_key")
  meta                Json // { iv, salt, scheme }
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  farmerId            String   @unique @map("farmer_id")
  farmer              Farmer   @relation(fields: [farmerId], references: [id])

  @@map("farmer_keys")
}
